// å®Œæ•´çš„èª²ç¨‹é ç´„ç³»çµ± Schema - è£œå……ç¼ºæ¼çš„è¡¨æ ¼

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ğŸ‘¥ æœƒå“¡ç®¡ç†
model Member {
  id    BigInt @id @default(autoincrement())
  name  String @db.VarChar(100)
  email String @unique @db.VarChar(100)
  phone String @unique @db.VarChar(50)

  // æœƒå“¡è³‡è¨Š
  birthDate DateTime? @map("birth_date") @db.Date
  gender    String?   @db.VarChar(10) // "male", "female", "other"

  // é—œè¯
  bookings     Booking[]
  coachProfile Coach?        // å¦‚æœæœƒå“¡ä¹Ÿæ˜¯æ•™ç·´
  reservations Reservation[] // å¦‚æœæœ‰å ´åœ°é ç´„åŠŸèƒ½

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("member")
}

// ğŸ¾ é‹å‹•é …ç›®è¡¨ï¼ˆä½ çš„ Coach å’Œ Lesson éƒ½åƒç…§äº†é€™å€‹è¡¨ï¼‰
model Sport {
  id          Int     @id @default(autoincrement())
  name        String  @db.VarChar(50)           // "ç¶²çƒ", "ç¾½æ¯›çƒ", "ç±ƒçƒ"
  description String? @db.Text
  
  // é—œè¯
  coaches Coach[]
  lessons Lesson[]
  
  @@map("sport")
}

// ğŸ‘¨â€ğŸ« æ•™ç·´ç®¡ç†
model Coach {
  id       Int    @id @default(autoincrement())
  member   Member @relation(fields: [memberId], references: [id])
  memberId BigInt @map("member_id")
  sport    Sport  @relation(fields: [sportId], references: [id])
  sportId  Int    @map("sport_id") // ä¿®æ­£ï¼šåŸæœ¬æ˜¯ sport__id
  bio      String? @db.VarChar(200)

  lessons Lesson[]

  @@map("coach")
}

// ğŸ• æ™‚é–“åˆ†é¡è¡¨
model TimePeriod {
  id        Int        @id @default(autoincrement())
  name      String     @db.VarChar(50)           // "æ—©ä¸Šæ™‚æ®µ", "ä¸‹åˆæ™‚æ®µ", "æ™šä¸Šæ™‚æ®µ"
  startTime String     @map("start_time") @db.Time // "06:00:00"
  endTime   String     @map("end_time") @db.Time   // "12:00:00"
  
  timeSlots TimeSlot[]
  
  @@map("time_period")
}

// ğŸ•‘ æ™‚é–“æ®µç®¡ç†
model TimeSlot {
  id           Int        @id @default(autoincrement())
  startTime    DateTime   @map("start_time") @db.Time
  endTime      DateTime   @map("end_time") @db.Time
  timePeriod   TimePeriod @relation(fields: [timePeriodId], references: [id])
  timePeriodId Int        @map("time_period_id")

  // é—œè¯
  courtTimeSlots CourtTimeSlot[]
  lessons        Lesson[]
  reservations   Reservation[]

  @@map("time_slot")
}

// ğŸŸï¸ å ´åœ°ç®¡ç†
model Court {
  id          Int    @id @default(autoincrement())
  name        String @db.VarChar(50)                 // "ç¶²çƒå ´A", "ç¾½æ¯›çƒå ´1"
  description String? @db.Text
  capacity    Int?                                    // å ´åœ°å®¹é‡
  
  // é—œè¯
  courtTimeSlots CourtTimeSlot[]
  lessons        Lesson[]
  reservations   Reservation[]
  
  @@map("court")
}

// ğŸ”— å ´åœ°æ™‚é–“æ®µé—œè¯ï¼ˆå ´åœ°åœ¨å“ªäº›æ™‚é–“æ®µé–‹æ”¾ï¼‰
model CourtTimeSlot {
  id         Int      @id @default(autoincrement())
  court      Court    @relation(fields: [courtId], references: [id])
  courtId    Int      @map("court_id")
  timeSlot   TimeSlot @relation(fields: [timeSlotId], references: [id])
  timeSlotId Int      @map("time_slot_id")
  
  // å¯é¸ï¼šè©²å ´åœ°åœ¨è©²æ™‚æ®µçš„ç‰¹æ®Šè¨­å®š
  isActive   Boolean  @default(true) @map("is_active")    // æ˜¯å¦é–‹æ”¾
  price      Int?                                          // è©²æ™‚æ®µçš„ç‰¹æ®Šåƒ¹æ ¼
  
  @@unique([courtId, timeSlotId])  // é˜²æ­¢é‡è¤‡è¨­å®š
  @@map("court_time_slot")
}

// ğŸ“š èª²ç¨‹ç³»åˆ—
model Lesson {
  id Int @id @default(autoincrement())

  // åŸºæœ¬è³‡è¨Š
  title       String  @db.VarChar(100) // "7æœˆç¶²çƒåˆç´šç­"
  description String? @db.Text

  // é—œè¯è³‡æº
  sport      Sport    @relation(fields: [sportId], references: [id])
  sportId    Int      @map("sport_id") // ä¿®æ­£ï¼šåŸæœ¬æ˜¯ sport__id
  court      Court    @relation(fields: [courtId], references: [id])
  courtId    Int      @map("court_id")
  coach      Coach    @relation(fields: [coachId], references: [id])
  coachId    Int      @map("coach_id")
  timeSlot   TimeSlot @relation(fields: [timeSlotId], references: [id])
  timeSlotId Int      @map("time_slot_id")

  // æ’ç¨‹è¨­å®š
  dayOfWeek Int      @map("day_of_week") // 1=æ˜ŸæœŸä¸€, 7=æ˜ŸæœŸæ—¥
  startDate DateTime @map("start_date") @db.Date // èª²ç¨‹ç³»åˆ—é–‹å§‹æ—¥æœŸ
  endDate   DateTime @map("end_date") @db.Date // èª²ç¨‹ç³»åˆ—çµæŸæ—¥æœŸ

  // èª²ç¨‹è¨­å®š
  price        Int // æ•´å€‹ç³»åˆ—åƒ¹æ ¼
  maxCapacity  Int @map("max_capacity") // æœ€å¤§äººæ•¸
  currentCount Int @default(0) @map("current_count") // ç›®å‰å ±åäººæ•¸
  
  // ç‹€æ…‹ç®¡ç†
  status       String @default("active") @db.VarChar(20) // active, cancelled, completed

  // å ±åè¨˜éŒ„
  bookings Booking[]
  
  // æ™‚é–“æˆ³è¨˜
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("lesson")
}

// ğŸ“ å ±åè¨˜éŒ„
model Booking {
  id Int @id @default(autoincrement())

  // é—œè¯
  member   Member @relation(fields: [memberId], references: [id])
  memberId BigInt @map("member_id")
  lesson   Lesson @relation(fields: [lessonId], references: [id])
  lessonId Int    @map("lesson_id")

  // å ±åè³‡è¨Š
  status String @default("confirmed") @db.VarChar(20) // confirmed, cancelled, completed
  price  Int // å¯¦éš›æ”¯ä»˜é‡‘é¡
  notes  String? @db.Text // å‚™è¨»

  // æ™‚é–“æˆ³è¨˜
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // é˜²æ­¢é‡è¤‡å ±å
  @@unique([memberId, lessonId])
  @@map("booking")
}

// ğŸ”„ é ç´„ç‹€æ…‹ç®¡ç†ï¼ˆå¦‚æœéœ€è¦å ´åœ°é ç´„åŠŸèƒ½ï¼‰
model ReservationStatus {
  id           Int           @id @default(autoincrement())
  name         String        @db.VarChar(20)           // "confirmed", "pending", "cancelled"
  description  String?       @db.VarChar(100)          // ç‹€æ…‹èªªæ˜
  reservations Reservation[]
  
  @@map("reservation_status")
}

// ğŸ“… å ´åœ°é ç´„ï¼ˆå¯é¸åŠŸèƒ½ï¼‰
model Reservation {
  id                  Int               @id @default(autoincrement())
  
  // é—œè¯
  member              Member            @relation(fields: [memberId], references: [id])
  memberId            BigInt            @map("member_id")
  court               Court             @relation(fields: [courtId], references: [id])
  courtId             Int               @map("court_id")
  timeSlot            TimeSlot          @relation(fields: [timeSlotId], references: [id])
  timeSlotId          Int               @map("time_slot_id")
  reservationStatus   ReservationStatus @relation(fields: [reservationStatusId], references: [id])
  reservationStatusId Int               @map("reservation_status_id")
  
  // é ç´„è³‡è¨Š
  date                DateTime          @db.Date                        // é ç´„æ—¥æœŸ
  price               Int                                               // é ç´„è²»ç”¨
  purpose             String?           @db.VarChar(100)               // é ç´„ç›®çš„
  notes               String?           @db.Text                       // å‚™è¨»
  
  // æ™‚é–“æˆ³è¨˜
  createdAt           DateTime          @default(now()) @map("created_at")
  updatedAt           DateTime          @updatedAt @map("updated_at")
  
  // é˜²æ­¢åŒä¸€æ™‚æ®µé‡è¤‡é ç´„
  @@unique([courtId, timeSlotId, date])
  @@map("reservation")
}